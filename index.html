<!DOCTYPE html>
<html>
	<head>
		<title>EC2 instance types pricing table comparison</title>
		<link href="https://unpkg.com/tabulator-tables@5.0.7/dist/css/tabulator_midnight.min.css" rel="stylesheet">
		<style>
			html {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
				color:#ddd;
				background: #222;
			}
			a,a:visited{color:#9af}
		</style>
	</head>
	<body>

		<h1>AWS EC2 Instance pricing comparison</h1>

		<p>The data is pulled directly from AWS docs, the same JSON endpoint their <a href="https://aws.amazon.com/ec2/pricing/on-demand/" rel="nofollow">pricing page</a> pulls it from, so the data is always up to date. The pricing is for "on-demand" instances US-East only for now.</p>

		<p>The reason I built this is because <u><code>https://ec2instances.info/</code></u> - the website I used before - has been acquired, became out of date and misses some pricing (many instance types simply say "unavailable"). So I put together this little app (40 lines of vanilla JS) to pull data from AWS docs directly and display it in a sortable table.</p>

		<p><iframe src="https://ghbtns.com/github-btn.html?user=ec2instances&repo=ec2instances.github.io&type=watch&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe></p>

		<div id="example-table"></div>
	
 		<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script>
		<script>
			(async function() {
	  
				var linUrl = "https://b0.p.awsstatic.com/pricing/2.0/meteredUnitMaps/ec2/USD/current/ec2-ondemand-without-sec-sel/US%20East%20(Ohio)/Linux/index.json?timestamp=1639230933739";
				var winUrl = "https://b0.p.awsstatic.com/pricing/2.0/meteredUnitMaps/ec2/USD/current/ec2-ondemand-without-sec-sel/US%20East%20(Ohio)/Windows/index.json?timestamp=1639230933739"

				//pull linux
				var url = 'https://api.allorigins.win/get?url=' + encodeURIComponent(linUrl);
				var response = await fetch(url);
				var data = await response.json();
				var regions = JSON.parse(data.contents).regions;
				var instances = regions[Object.keys(regions)[0]];
				var instancesArray = Object.values(instances);

				//now for Windows
				var url = 'https://api.allorigins.win/get?url=' + encodeURIComponent(winUrl);
				response = await fetch(url);
				data = await response.json();
				regions = JSON.parse(data.contents).regions;
				instances = regions[Object.keys(regions)[0]];
				instancesArray = instancesArray.concat(Object.values(instances)); //merge two arrays together

				//now add "monthly price" (hourly * 730 hours per month)
				instancesArray.forEach(i => {
					i.priceMonthly = i.price * 730;
				});


				var table = new Tabulator("#example-table", {
				 	height:900, // set height of table (in CSS or here), this enables the Virtual DOM and improves render speed dramatically (can be any valid css height value)
				 	data: instancesArray, //assign data to table
				 	layout:"fitColumns", //fit columns to width of table (optional)
					columns: [
						{title: "Instance Type", field:"Instance Type"},
						{title: "Price", field:"price", sorter:"number", formatter:"money", formatterParams:{precision:4}},
						{title: "Monthly price", field:"priceMonthly", sorter:"number", formatter:"money", formatterParams:{thousand:" ",precision:2}},
						{title: "vCPU", field: "vCPU", sorter:"number"},
						{title: "Memory", field: "Memory", sorter:"number"},
						{title: "Operating System", field: "Operating System"},
						{title: "Storage", field: "Storage", sorter:"number"},
						{title: "Network Performance", field: "Network Performance"},
					]
				});
			})();

		</script>
	</body>
</html>
