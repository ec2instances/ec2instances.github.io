<!DOCTYPE html>
<html style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;">
	<head>
		<title>EC2 pricing table comparison</title>
		<link href="https://unpkg.com/tabulator-tables@5.0.7/dist/css/tabulator.min.css" rel="stylesheet">
	</head>
	<body>

		<div id="example-table"></div>
		
		<br>
		
		<iframe src="https://ghbtns.com/github-btn.html?user=ec2instances&repo=ec2instances.github.io&type=watch&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>
		
 		<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script>
		<script>
			(async function() {
	  
				var linUrl = "https://b0.p.awsstatic.com/pricing/2.0/meteredUnitMaps/ec2/USD/current/ec2-ondemand-without-sec-sel/US%20East%20(Ohio)/Linux/index.json?timestamp=1639230933739";
				var winUrl = "https://b0.p.awsstatic.com/pricing/2.0/meteredUnitMaps/ec2/USD/current/ec2-ondemand-without-sec-sel/US%20East%20(Ohio)/Windows/index.json?timestamp=1639230933739"

				var url = 'https://api.allorigins.win/get?url=' + encodeURIComponent(linUrl);
				var response = await fetch(url);
				var data = await response.json();
				var regions = JSON.parse(data.contents).regions;
				var instances = regions[Object.keys(regions)[0]];
				var instancesArray = Object.values(instances);

				//now for Windows
				var url = 'https://api.allorigins.win/get?url=' + encodeURIComponent(winUrl);
				response = await fetch(url);
				data = await response.json();
				regions = JSON.parse(data.contents).regions;
				instances = regions[Object.keys(regions)[0]];
				instancesArray = instancesArray.concat(Object.values(instances)); //merge two arrays together

				//now add "monthly price" (hourly * 730 hours per month)
				instancesArray.forEach(i => {
					i.priceMonthly = i.price * 730;
				});


				var table = new Tabulator("#example-table", {
				 	height:900, // set height of table (in CSS or here), this enables the Virtual DOM and improves render speed dramatically (can be any valid css height value)
				 	data: instancesArray, //assign data to table
				 	layout:"fitColumns", //fit columns to width of table (optional)
					columns: [
						{title: "Instance Type", field:"Instance Type"},
						{title: "Price", field:"price", sorter:"number"},
						{title: "Monthly price", field:"priceMonthly", sorter:"number"},
						{title: "vCPU", field: "vCPU", sorter:"number"},
						{title: "Memory", field: "Memory", sorter:"number"},
						{title: "Operating System", field: "Operating System"},
						{title: "Storage", field: "Storage", sorter:"number"},
						{title: "Network Performance", field: "Network Performance"},
					]
				});
			})();

		</script>
	</body>
</html>
